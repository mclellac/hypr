#!/bin/bash
#
# Provides a collection of dmenu-style menus for managing the Hyprland environment,
# including theme selection, application launching, and system controls.

set -euo pipefail

#######################################
# Displays a dmenu-style menu using walker.
# Globals:
#   None
# Arguments:
#   $1 - The prompt to display.
#   $2 - A newline-separated string of options.
#   $3 - (Optional) Extra arguments to pass to walker.
#   $4 - (Optional) The option to pre-select.
# Outputs:
#   The selected option from the menu.
#######################################
menu() {
  local prompt="$1"
  local options="$2"
  local extra_args_str="${3:-}"
  local preselect="${4:-}"
  local -a args

  # shellcheck disable=SC2206
  args=($extra_args_str)

  if [[ -n "${preselect}" ]]; then
    local index
    # The `grep` command gets the line number of the pre-selected option.
    # The `cut` command extracts the line number.
    index=$(echo -e "${options}" | grep -nxF "${preselect}" | cut -d: -f1)
    if [[ -n "${index}" ]]; then
      # walker uses a zero-based index for pre-selection.
      args+=("-c" "$((index - 1))")
    fi
  fi

  # The `walker` command displays the dmenu.
  echo -e "${options}" | walker --dmenu -p "${prompt}…" "${args[@]}"
}

#######################################
# Launches a command in a new Alacritty terminal window.
# Globals:
#   None
# Arguments:
#   $@ - The command and its arguments to execute.
# Outputs:
#   None
#######################################
terminal() {
  alacritty --class hypr -e "$@"
}

#######################################
# Launches a command in a floating terminal for presentations.
# Globals:
#   None
# Arguments:
#   $1 - The command to execute.
# Outputs:
#   None
#######################################
present_terminal() {
  hypr-launch-floating-terminal-with-presentation "$1"
}

#######################################
# Opens a file for editing in Neovim within a new terminal window.
# Globals:
#   None
# Arguments:
#   $1 - The path to the file to edit.
# Outputs:
#   None
#######################################
edit_in_nvim() {
  notify-send "Editing config file" "$1"
  alacritty -e nvim "$1"
}

#######################################
# Installs a package using pacman.
# Globals:
#   None
# Arguments:
#   $1 - The name of the package for display purposes.
#   $2 - The package name to pass to pacman.
# Outputs:
#   None
#######################################
install() {
  present_terminal "echo 'Installing $1...'; sudo pacman -S --noconfirm $2"
}

#######################################
# Installs a package and launches it.
# Globals:
#   None
# Arguments:
#   $1 - The name of the application for display purposes.
#   $2 - The package name to pass to pacman.
#   $3 - The desktop file name to launch.
# Outputs:
#   None
#######################################
install_and_launch() {
  present_terminal "echo 'Installing $1...'; sudo pacman -S --noconfirm $2 && setsid gtk-launch $3"
}

#######################################
# Installs a font and sets it as the current font.
# Globals:
#   None
# Arguments:
#   $1 - The name of the font for display purposes.
#   $2 - The package name of the font.
#   $3 - The full name of the font to be set.
# Outputs:
#   None
#######################################
install_font() {
  present_terminal "echo 'Installing $1...'; sudo pacman -S --noconfirm --needed $2 && sleep 2 && hypr-font-set '$3'"
}

#######################################
# Installs a package from the AUR using yay.
# Globals:
#   None
# Arguments:
#   $1 - The name of the package for display purposes.
#   $2 - The package name to pass to yay.
# Outputs:
#   None
#######################################
aur_install() {
  present_terminal "echo 'Installing $1 from AUR...'; yay -S --noconfirm $2"
}

#######################################
# Installs a package from the AUR and launches it.
# Globals:
#   None
# Arguments:
#   $1 - The name of the application for display purposes.
#   $2 - The package name to pass to yay.
#   $3 - The desktop file name to launch.
# Outputs:
#   None
#######################################
aur_install_and_launch() {
  present_terminal "echo 'Installing $1 from AUR...'; yay -S --noconfirm $2 && setsid gtk-launch $3"
}

#######################################
# Displays a menu for work-related web applications.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_work_menu() {
  local options="󰔾  Akamai\n  Jira\n  GitLab\n  Bitbucket\n  Confluence\n  Bamboo\n  OpenShift Internal\n  OpenShift Prod\n  Gmail\n  Google Calendar\n 5736 AWS\n 1300 AWS"
  local choice
  choice=$(menu "Work" "${options}")

  case "${choice}" in
    *"Akamai"*) hypr-launch-webapp "https://control.akamai.com" ;;
    *"Jira"*) hypr-launch-webapp "https://cbc-digital.atlassian.net/jira/dashboards/10092" ;;
    *"GitLab"*) hypr-launch-webapp "https://gitlab.nm.cbc.ca" ;;
    *"Bitbucket"*) hypr-launch-webapp "https://bitbucket.org/cbc-digital/workspace/overview" ;;
    *"Confluence"*) hypr-launch-webapp "https://cbc-digital.atlassian.net/wiki/spaces/~McLellac/" ;;
    *"Bamboo"*) hypr-launch-webapp "https://bamboo.nm.cbc.ca" ;;
    *"Internal"*) hypr-launch-webapp "https://console-openshift-console.apps.ocp.int.nm.cbc.ca/" ;;
    *"Prod"*) hypr-launch-webapp "https://console-openshift-console.apps.ocp.nm.cbc.ca/" ;;
    *"Gmail"*) hypr-launch-webapp "https://gmail.com" ;;
    *"Calendar"*) hypr-launch-webapp "https://calendar.google.com" ;;
    *"5736 AWS"*) hypr-launch-webapp "https://573618582034.signin.aws.amazon.com/console/" ;;
    *"1300 AWS"*) hypr-launch-webapp "https://130084070345.signin.aws.amazon.com/console/" ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for online development resources.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_resources_menu() {
  local options="󰣇  Arch\n  Keybindings\n󰅛  OWASP Cheats\n  Web Attack Cheats\n󰎑  PayloadAllTheThings\n󱆃  HackTricks\n  Exploit DB\n  GTFOBins\n󰯁  LOLBAS\n󱎴  PEASS\n󱫋  SecLists\n󰢩  Reverse Shells\n󰲊  Pentest Monkey Cheats"
  local choice
  choice=$(menu "Resources" "${options}")

  case "${choice}" in
    *"Arch"*) hypr-launch-webapp "https://wiki.archlinux.org/title/Main_page" ;;
    *"Keybindings"*) hypr-menu-keybindings ;;
    *"OWASP"*) hypr-launch-webapp "https://cheatsheetseries.owasp.org/index.html" ;;
    *"Web"*) hypr-launch-webapp "https://github.com/riramar/Web-Attack-Cheat-Sheet" ;;
    *"PayloadsAllTheThings"*) hypr-launch-webapp "https://github.com/swisskyrepo/PayloadsAllTheThings" ;;
    *"HackTricks"*) hypr-launch-webapp "https://book.hacktricks.xyz" ;;
    *"Exploit DB"*) hypr-launch-webapp "https://www.exploit-db.com" ;;
    *"GTFOBins"*) hypr-launch-webapp "https://gtfobins.github.io" ;;
    *"LOLBAS"*) hypr-launch-webapp "https://lolbas-project.github.io" ;;
    *"PEASS"*) hypr-launch-webapp "https://github.com/peass-ng/PEASS-ng" ;;
    *"SecLists"*) hypr-launch-webapp "https://github.com/danielmiessler/SecLists" ;;
    *"Reverse Shells"*) hypr-launch-webapp "https://www.revshells.com/" ;;
    *"Pentest Monkey Cheats"*) hypr-launch-webapp "https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for managing visual styles.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_style_menu() {
  local options="󰸌  Theme\n  Font\n  Background\n󱄄  Screensaver\n  About"
  local choice
  choice=$(menu "Style" "${options}")

  case "${choice}" in
    *"Theme"*) show_theme_menu ;;
    *"Font"*) show_font_menu ;;
    *"Background"*) hypr-theme-bg-next ;;
    *"Screensaver"*) edit_in_nvim ~/.config/hypr/branding/screensaver.txt ;;
    *"About"*) edit_in_nvim ~/.config/hypr/branding/about.txt ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for selecting and applying a new theme.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_theme_menu() {
  local theme
  theme=$(menu "Theme" "$(hypr-theme-list)" "" "$(hypr-theme-current)")
  if [[ "${theme}" != "CNCLD" && -n "${theme}" ]]; then
    hypr-theme-set "${theme}"
  else
    show_main_menu
  fi
}

#######################################
# Displays a menu for selecting and applying a new font.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_font_menu() {
  local font
  font=$(menu "Font" "$(hypr-font-list)" "--width 350" "$(hypr-font-current)")
  if [[ "${font}" != "CNCLD" && -n "${font}" ]]; then
    hypr-font-set "${font}"
  else
    show_main_menu
  fi
}

#######################################
# Displays a menu for screen capture options.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_capture_menu() {
  local options="  Screenshot\n  Screenrecord\n󰃉  Color"
  local choice
  choice=$(menu "Capture" "${options}")

  case "${choice}" in
    *"Screenshot"*) show_screenshot_menu ;;
    *"Screenrecord"*) show_screenrecord_menu ;;
    *"Color"*) pkill hyprpicker || hyprpicker -a ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for different screenshot modes.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_screenshot_menu() {
  local options="  Region\n  Window\n  Display"
  local choice
  choice=$(menu "Screenshot" "${options}")

  case "${choice}" in
    *"Region"*) hypr-cmd-screenshot ;;
    *"Window"*) hypr-cmd-screenshot window ;;
    *"Display"*) hypr-cmd-screenshot output ;;
    *) show_capture_menu ;;
  esac
}

#######################################
# Displays a menu for different screen recording modes.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_screenrecord_menu() {
  local options="  Region\n  Display"
  local choice
  choice=$(menu "Screenrecord" "${options}")

  case "${choice}" in
    *"Region"*) hypr-cmd-screenrecord ;;
    *"Display"*) hypr-cmd-screenrecord output ;;
    *) show_capture_menu ;;
  esac
}

#######################################
# Displays a menu for toggling system features.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_toggle_menu() {
  local options="󱄄  Screensaver\n󰔎  Nightlight\n󱫖  Idle Lock\n󰍜  Top Bar"
  local choice
  choice=$(menu "Toggle" "${options}")

  case "${choice}" in
    *"Screensaver"*) hypr-toggle-screensaver ;;
    *"Nightlight"*) hypr-toggle-nightlight ;;
    *"Idle"*) hypr-toggle-idle ;;
    *"Bar"*) hypr-toggle-waybar ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for system setup and configuration.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_setup_menu() {
  local options="  Audio\n  Wifi\n󰂯  Bluetooth\n󱐋  Power Profile\n󰍹  Monitors"
  if [[ -f ~/.config/hypr/bindings.conf ]]; then
    options+="\n  Keybindings"
  fi
  if [[ -f ~/.config/hypr/input.conf ]]; then
    options+="\n  Input"
  fi
  options+="\n󰱔  DNS\n  Config\n󰈷  Fingerprint\n  Fido2"

  local choice
  choice=$(menu "Setup" "${options}")

  case "${choice}" in
    *"Audio"*) alacritty --class=Wiremix -e wiremix ;;
    *"Wifi"*)
      rfkill unblock wifi
      alacritty --class=Impala -e impala
      ;;
    *"Bluetooth"*)
      rfkill unblock bluetooth
      blueberry
      ;;
    *"Power"*) show_setup_power_menu ;;
    *"Monitors"*) edit_in_nvim ~/.config/hypr/monitors.conf ;;
    *"Keybindings"*) edit_in_nvim ~/.config/hypr/bindings.conf ;;
    *"Input"*) edit_in_nvim ~/.config/hypr/input.conf ;;
    *"DNS"*) present_terminal "hypr-setup-dns" ;;
    *"Config"*) show_setup_config_menu ;;
    *"Fingerprint"*) present_terminal "hypr-setup-fingerprint" ;;
    *"Fido2"*) present_terminal "hypr-setup-fido2" ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for setting the power profile.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_setup_power_menu() {
  local profile
  profile=$(menu "Power Profile" "$(hypr-powerprofiles-list)" "" "$(powerprofilesctl get)")

  if [[ "${profile}" != "CNCLD" && -n "${profile}" ]]; then
    powerprofilesctl set "${profile}"
  else
    show_main_menu
  fi
}

#######################################
# Displays a menu for editing application configuration files.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_setup_config_menu() {
  local options="  Hyprland\n  Hypridle\n  Hyprlock\n  Hyprsunset\n  Swayosd\n󰌧  Walker\n󰍜  Waybar\n󰞅  XCompose"
  local choice
  choice=$(menu "Setup" "${options}")

  case "${choice}" in
    *"Hyprland"*) edit_in_nvim ~/.config/hypr/hyprland.conf ;;
    *"Hypridle"*)
      edit_in_nvim ~/.config/hypr/hypridle.conf
      hypr-restart-hypridle
      ;;
    *"Hyprlock"*) edit_in_nvim ~/.config/hypr/hyprlock.conf ;;
    *"Hyprsunset"*)
      edit_in_nvim ~/.config/hypr/hyprsunset.conf
      hypr-restart-hyprsunset
      ;;
    *"Swayosd"*)
      edit_in_nvim ~/.config/swayosd/config.toml
      hypr-restart-swayosd
      ;;
    *"Walker"*)
      edit_in_nvim ~/.config/walker/config.toml
      hypr-restart-walker
      ;;
    *"Waybar"*)
      edit_in_nvim ~/.config/waybar/config.jsonc
      hypr-restart-waybar
      ;;
    *"XCompose"*)
      edit_in_nvim ~/.XCompose
      hypr-restart-xcompose
      ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays the main installation menu.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_menu() {
  local options="󰣇  Package\n󰣇  AUR\n  Web App\n  TUI\n  Service\n  Style\n󰵮  Development\n  Editor\n󱚤  AI\n  Gaming"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Package"*) terminal "hypr-pkg-install" ;;
    *"AUR"*) terminal "hypr-pkg-aur-install" ;;
    *"Web"*) present_terminal "hypr-webapp-install" ;;
    *"TUI"*) present_terminal "hypr-tui-install" ;;
    *"Service"*) show_install_service_menu ;;
    *"Style"*) show_install_style_menu ;;
    *"Development"*) show_install_development_menu ;;
    *"Editor"*) show_install_editor_menu ;;
    *"AI"*) show_install_ai_menu ;;
    *"Gaming"*) show_install_gaming_menu ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for installing system services.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_service_menu() {
  local options="  Dropbox\n  Tailscale\n󰟵  Bitwarden"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Dropbox"*) present_terminal "hypr-install-dropbox" ;;
    *"Tailscale"*) present_terminal "hypr-install-tailscale" ;;
    *"Bitwarden"*) install_and_launch "Bitwarden" "bitwarden bitwarden-cli" "bitwarden" ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing text editors.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_editor_menu() {
  local options="  VSCode\n  Cursor\n  Zed\n  Sublime Text\n  Helix\n  Emacs"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"VSCode"*) install_and_launch "VSCode" "visual-studio-code-bin" "code" ;;
    *"Cursor"*) install_and_launch "Cursor" "cursor-bin" "cursor" ;;
    *"Zed"*) install_and_launch "Zed" "zed" "dev.zed.Zed" ;;
    *"Sublime"*) aur_install_and_launch "Sublime Text" "sublime-text-4" "sublime_text" ;;
    *"Helix"*) install "Helix" "helix" ;;
    *"Emacs"*)
      install "Emacs" "emacs-wayland"
      systemctl --user enable --now emacs.service
      ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing AI and machine learning tools.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_ai_menu() {
  local ollama_pkg="ollama"
  if command -v nvidia-smi &>/dev/null; then
    ollama_pkg="ollama-cuda"
  elif command -v rocminfo &>/dev/null; then
    ollama_pkg="ollama-rocm"
  fi

  local options="󱚤  Claude Code\n󱚤  Gemini\n󱚤  OpenAI Codex [AUR]\n󱚤  LM Studio\n󱚤  Ollama\n󱚤  Crush\n󱚤  opencode"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Claude"*) install "Claude Code" "claude-code" ;;
    *"OpenAI"*) aur_install "OpenAI Codex" "openai-codex-bin" ;;
    *"Gemini"*) install "Gemini" "gemini-cli" ;;
    *"Studio"*) install "LM Studio" "lmstudio" ;;
    *"Ollama"*) install "Ollama" "${ollama_pkg}" ;;
    *"Crush"*) install "Crush" "crush-bin" ;;
    *"opencode"*) install "opencode" "opencode-bin" ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing gaming-related applications.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_gaming_menu() {
  local options="  Steam\n  RetroArch [AUR]\n󰍳  Minecraft"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Steam"*) present_terminal "hypr-install-steam" ;;
    *"RetroArch"*) aur_install_and_launch "RetroArch" "retroarch retroarch-assets libretro libretro-fbneo" "com.libretro.RetroArch.desktop" ;;
    *"Minecraft"*) install_and_launch "Minecraft" "minecraft-launcher" "minecraft-launcher" ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing style-related assets like themes and fonts.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_style_menu() {
  local options="󰸌  Theme\n  Background\n  Font"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Theme"*) present_terminal "hypr-theme-install" ;;
    *"Background"*) nautilus ~/.config/hypr/current/theme/backgrounds ;;
    *"Font"*) show_install_font_menu ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing different fonts.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_font_menu() {
  local options="  Meslo LG Mono\n  Fira Code\n  Victor Code\n  Bistream Vera Mono"
  local choice
  choice=$(menu "Install" "${options}" "-w 350")

  case "${choice}" in
    *"Meslo"*) install_font "Meslo LG Mono" "ttf-meslo-nerd" "MesloLGL Nerd Font" ;;
    *"Fira"*) install_font "Fira Code" "ttf-firacode-nerd" "FiraCode Nerd Font" ;;
    *"Victor"*) install_font "Victor Code" "ttf-victor-mono-nerd" "VictorMono Nerd Font" ;;
    *"Bistream"*) install_font "Bistream Vera Code" "ttf-bitstream-vera-mono-nerd" "BitstromWera Nerd Font" ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing development environments.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_development_menu() {
  local options="󰫏  Ruby on Rails\n  Docker DB\n  JavaScript\n  Go\n  PHP\n  Python\n  Elixir\n  Zig\n  Rust\n  Java\n  .NET\n  OCaml"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Rails"*) present_terminal "hypr-install-dev-env ruby" ;;
    *"Docker"*) present_terminal "hypr-install-docker-dbs" ;;
    *"JavaScript"*) show_install_javascript_menu ;;
    *"Go"*) present_terminal "hypr-install-dev-env go" ;;
    *"PHP"*) show_install_php_menu ;;
    *"Python"*) present_terminal "hypr-install-dev-env python" ;;
    *"Elixir"*) show_install_elixir_menu ;;
    *"Zig"*) present_terminal "hypr-install-dev-env zig" ;;
    *"Rust"*) present_terminal "hypr-install-dev-env rust" ;;
    *"Java"*) present_terminal "hypr-install-dev-env java" ;;
    *".NET"*) present_terminal "hypr-install-dev-env dotnet" ;;
    *"OCaml"*) present_terminal "hypr-install-dev-env ocaml" ;;
    *) show_install_menu ;;
  esac
}

#######################################
# Displays a menu for installing JavaScript runtimes.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_javascript_menu() {
  local options="  Node.js\n  Bun\n  Deno"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Node"*) present_terminal "hypr-install-dev-env node" ;;
    *"Bun"*) present_terminal "hypr-install-dev-env bun" ;;
    *"Deno"*) present_terminal "hypr-install-dev-env deno" ;;
    *) show_install_development_menu ;;
  esac
}

#######################################
# Displays a menu for installing PHP frameworks.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_php_menu() {
  local options="  PHP\n  Laravel\n  Symfony"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"PHP"*) present_terminal "hypr-install-dev-env php" ;;
    *"Laravel"*) present_terminal "hypr-install-dev-env laravel" ;;
    *"Symfony"*) present_terminal "hypr-install-dev-env symfony" ;;
    *) show_install_development_menu ;;
  esac
}

#######################################
# Displays a menu for installing Elixir frameworks.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_install_elixir_menu() {
  local options="  Elixir\n  Phoenix"
  local choice
  choice=$(menu "Install" "${options}")

  case "${choice}" in
    *"Elixir"*) present_terminal "hypr-install-dev-env elixir" ;;
    *"Phoenix"*) present_terminal "hypr-install-dev-env phoenix" ;;
    *) show_install_development_menu ;;
  esac
}

#######################################
# Displays a menu for removing software and configurations.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_remove_menu() {
  local options="󰣇  Package\n  Web App\n  TUI\n󰸌  Theme\n󰈷  Fingerprint\n  Fido2"
  local choice
  choice=$(menu "Remove" "${options}")

  case "${choice}" in
    *"Package"*) terminal "hypr-pkg-remove" ;;
    *"Web"*) present_terminal "hypr-webapp-remove" ;;
    *"TUI"*) present_terminal "hypr-tui-remove" ;;
    *"Theme"*) present_terminal "hypr-theme-remove" ;;
    *"Fingerprint"*) present_terminal "hypr-setup-fingerprint --remove" ;;
    *"Fido2"*) present_terminal "hypr-setup-fido2 --remove" ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays the main update menu.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_update_menu() {
  local options=" hypr\n  Config\n󰸌  Themes\n  Process\n󰇅  Hardware\n  Timezone"
  local choice
  choice=$(menu "Update" "${options}")

  case "${choice}" in
    *"hypr"*) present_terminal "hypr-update" ;;
    *"Config"*) show_update_config_menu ;;
    *"Themes"*) present_terminal "hypr-theme-update" ;;
    *"Process"*) show_update_process_menu ;;
    *"Hardware"*) show_update_hardware_menu ;;
    *"Timezone"*) hypr-cmd-tzupdate ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays a menu for restarting system processes.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_update_process_menu() {
  local options="  Hypridle\n  Hyprsunset\n  Swayosd\n󰌧  Walker\n󰍜  Waybar"
  local choice
  choice=$(menu "Restart" "${options}")

  case "${choice}" in
    *"Hypridle"*) hypr-restart-hypridle ;;
    *"Hyprsunset"*) hypr-restart-hyprsunset ;;
    *"Swayosd"*) hypr-restart-swayosd ;;
    *"Walker"*) hypr-restart-walker ;;
    *"Waybar"*) hypr-restart-waybar ;;
    *) show_update_menu ;;
  esac
}

#######################################
# Displays a menu for restoring default configurations.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_update_config_menu() {
  local options="  Hyprland\n  Hypridle\n  Hyprlock\n  Hyprsunset\n󱣴  Plymouth\n  Swayosd\n󰌧  Walker\n󰍜  Waybar"
  local choice
  choice=$(menu "Use default config" "${options}")

  case "${choice}" in
    *"Hyprland"*) present_terminal "hypr-refresh-hyprland" ;;
    *"Hypridle"*) present_terminal "hypr-refresh-hypridle" ;;
    *"Hyprlock"*) present_terminal "hypr-refresh-hyprlock" ;;
    *"Hyprsunset"*) present_terminal "hypr-refresh-hyprsunset" ;;
    *"Plymouth"*) present_terminal "hypr-refresh-plymouth" ;;
    *"Swayosd"*) present_terminal "hypr-refresh-swayosd" ;;
    *"Walker"*) present_terminal "hypr-refresh-walker" ;;
    *"Waybar"*) present_terminal "hypr-refresh-waybar" ;;
    *) show_update_menu ;;
  esac
}

#######################################
# Displays a menu for restarting hardware-related services.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_update_hardware_menu() {
  local options="󱚾  Wi-Fi\n󰂯  Bluetooth"
  local choice
  choice=$(menu "Restart" "${options}")

  case "${choice}" in
    *"Wi-Fi"*) present_terminal "hypr-restart-wifi" ;;
    *"Bluetooth"*) present_terminal "hypr-restart-bluetooth" ;;
    *) show_update_menu ;;
  esac
}

#######################################
# Displays a menu for system-level power options.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_system_menu() {
  local options="  Lock\n󱄄  Screensaver\n󰤄  Suspend\n  Relaunch\n󰜉  Restart\n󰐥  Shutdown"
  local choice
  choice=$(menu "System" "${options}")

  case "${choice}" in
    *"Lock"*) hypr-lock-screen ;;
    *"Screensaver"*) hypr-launch-screensaver force ;;
    *"Suspend"*) systemctl suspend ;;
    *"Relaunch"*) uwsm stop ;;
    *"Restart"*) systemctl reboot ;;
    *"Shutdown"*) systemctl poweroff ;;
    *) show_main_menu ;;
  esac
}

#######################################
# Displays the main navigation menu.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
show_main_menu() {
  local options="󰀻  Apps\n󱃐  Work\n󰧑  Resources\n  Capture\n󰔎  Toggle\n  Style\n  Setup\n󰉉  Install\n󰭌  Remove\n  Update\n  About\n  System"
  go_to_menu "$(menu "Go" "${options}")"
}

#######################################
# Navigates to a specific menu based on user selection.
# Globals:
#   None
# Arguments:
#   $1 - The menu to navigate to.
# Outputs:
#   None
#######################################
go_to_menu() {
  local selection="${1,,}"
  case "${selection}" in
    *"apps"*) walker --provider desktopapplications -p "Launch…" ;;
    *"work"*) show_work_menu ;;
    *"resources"*) show_resources_menu ;;
    *"style"*) show_style_menu ;;
    *"theme"*) show_theme_menu ;;
    *"capture"*) show_capture_menu ;;
    *"screenshot"*) show_screenshot_menu ;;
    *"screenrecord"*) show_screenrecord_menu ;;
    *"toggle"*) show_toggle_menu ;;
    *"setup"*) show_setup_menu ;;
    *"power"*) show_setup_power_menu ;;
    *"install"*) show_install_menu ;;
    *"remove"*) show_remove_menu ;;
    *"update"*) show_update_menu ;;
    *"about"*) alacritty --class hypr -o font.size=9 -e bash -c 'fastfetch; read -n 1 -s' ;;
    *"system"*) show_system_menu ;;
  esac
}

#######################################
# Main function to run the script.
# Globals:
#   None
# Arguments:
#   $@ - The script arguments.
# Outputs:
#   None
#######################################
main() {
  export PATH="$HOME/.local/share/hypr/bin:$PATH"

  if [[ -n "${1:-}" ]]; then
    go_to_menu "$1"
  else
    show_main_menu
  fi
}

main "$@"
