#!/bin/bash
#
# Reads the list of pinned packages from the configuration file and prints
# them as a single, comma-separated string.

set -euo pipefail

#######################################
# Main function to read and format the pinned packages list.
# Globals:
#   HYPR_PATH - The root path of the hypr configuration.
# Arguments:
#   None
# Outputs:
#   A comma-separated string of pinned package names.
#######################################
main() {
  if [[ -z "${HYPR_PATH:-}" ]]; then
    echo "Error: HYPR_PATH environment variable is not set." >&2
    exit 1
  fi

  local pinned_packages_file="${HYPR_PATH}/install/packages.pinned"

  if [[ -f "${pinned_packages_file}" ]]; then
    # `tr` replaces newlines with commas, and `sed` removes the trailing comma.
    tr '\r\n' ',' <"${pinned_packages_file}" | sed 's/,$//'
  fi
}

main
