#!/bin/bash
#
# Lists the available power profiles using 'powerprofilesctl' and formats
# the output for use in menus.

set -euo pipefail

#######################################
# Main function to list and format power profiles.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   A newline-separated list of power profile names.
#######################################
main() {
  if ! command -v powerprofilesctl &>/dev/null; then
    echo "Error: 'powerprofilesctl' not found. Is power-profiles-daemon installed?" >&2
    exit 1
  fi

  # This pipeline does the following:
  # 1. 'powerprofilesctl list' gets the raw profile list.
  # 2. 'awk' extracts only the profile names, removing asterisks and colons.
  # 3. 'tac' reverses the order to a more intuitive "high power -> low power".
  powerprofilesctl list |
    awk '/^\s*[* ]\s*[a-zA-Z0-9\-]+:$/ { gsub(/^[*[:space:]]+|:$/,""); print }' |
    tac
}

main
