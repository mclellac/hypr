#!/bin/bash
#
# Updates the local hypr git repository by pulling the latest changes.

set -euo pipefail

#######################################
# Main function to update the git repository.
# Globals:
#   HYPR_PATH - The path to the hypr git repository.
# Arguments:
#   None
# Outputs:
#   None
#######################################
main() {
  if [[ -z "${HYPR_PATH:-}" || ! -d "${HYPR_PATH}/.git" ]]; then
    echo "Error: HYPR_PATH is not set or is not a git repository." >&2
    exit 1
  fi

  echo -e "\e[32mUpdating hypr repository...\e[0m"
  git -C "${HYPR_PATH}" pull --autostash

  # This checks for merge conflicts and resets if any are found.
  if ! git -C "${HYPR_PATH}" diff --check; then
    echo "Merge conflicts detected. Resetting..."
    git -C "${HYPR_PATH}" reset --merge
  fi
}

main
