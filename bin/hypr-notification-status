#!/usr/bin/env python3
import json
import os
import sys

LOG_FILE = os.path.expanduser("~/.local/share/hypr/notifications.json")

def main():
    count = 0
    tooltip = "No notifications"

    if os.path.exists(LOG_FILE):
        try:
            with open(LOG_FILE, 'r') as f:
                logs = json.load(f)
                count = len(logs)
                if count > 0:
                    tooltip = f"{count} notification(s)\n(Mid click to clear)"
                    # Show the latest few in tooltip
                    latest = logs[:5]
                    tooltip += "\n\n"
                    for notif in latest:
                        app = notif.get("app_name", "Unknown")
                        summary = notif.get("summary", "")
                        tooltip += f"• {app}: {summary}\n"
        except Exception:
            pass

    # Output JSON for waybar
    output = {
        "text": "", # Always show icon, or maybe count like " 5"
        "tooltip": tooltip,
        "class": "notifications" if count > 0 else "empty"
    }

    # If we want to show count in the bar:
    if count > 0:
        output["text"] = f" {count}"

    print(json.dumps(output))

if __name__ == "__main__":
    main()
