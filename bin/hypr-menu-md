#!/usr/bin/env bash
#
# Renders a Markdown file in the terminal and displays it through a pager.
# It attempts to use 'glow' or 'mdcat' for rendering, falling back to 'cat'.

set -euo pipefail

#######################################
# Renders a Markdown file using the best available tool.
# Globals:
#   None
# Arguments:
#   $1 - The path to the Markdown file.
# Outputs:
#   The rendered content of the Markdown file to stdout.
#######################################
render_markdown() {
  local file_path="$1"
  if command -v glow &>/dev/null; then
    glow -s dark "${file_path}"
  elif command -v mdcat &>/dev/null; then
    mdcat "${file_path}"
  else
    # Fallback to simple cat if no dedicated renderer is found.
    cat "${file_path}"
  fi
}

#######################################
# Main function to render and page the Markdown file.
# Globals:
#   None
# Arguments:
#   $1 - The path to the Markdown file.
# Outputs:
#   Exits with an error if the file is not provided or does not exist.
#######################################
main() {
  local file_path="${1:-}"
  if [[ -z "${file_path}" || ! -f "${file_path}" ]]; then
    echo "Usage: $(basename "$0") <markdown-file>" >&2
    exit 1
  fi

  # Pipe the rendered output to 'less' with color support enabled (-R).
  render_markdown "${file_path}" | less -R
}

main "$@"
