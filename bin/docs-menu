#!/bin/bash
#
# Provides a standalone cheatsheets menu focused on Linux, Web Security,
# Programming, Hacking, and Tools. All links point to live, viewable
# cheat-sheet pages or authoritative online docs.

set -euo pipefail

#######################################
# Displays a dmenu-style menu using walker.
# Globals:
#   None
# Arguments:
#   $1 - The prompt to display.
#   $2 - A newline-separated string of options.
#   $3 - (Optional) Extra arguments to pass to walker.
#   $4 - (Optional) The option to pre-select.
# Outputs:
#   The selected option from the menu.
#######################################
Menu() {
  local prompt="$1"
  local options="$2"
  local extra_args_str="${3:-}"
  local preselect="${4:-}"
  local -a args

  # shellcheck disable=SC2206
  args=($extra_args_str)

  if [[ -n "${preselect}" ]]; then
    local index
    index=$(echo -e "${options}" | grep -nxF "${preselect}" | cut -d: -f1)
    if [[ -n "${index}" ]]; then
      args+=("-c" "$((index - 1))")
    fi
  fi

  echo -e "${options}" | walker --dmenu -p "${prompt}…" "${args[@]}"
}

#######################################
# Opens a URL in the default web application.
# Globals:
#   None
# Arguments:
#   $1 - The URL to open.
# Outputs:
#   None
#######################################
OpenWeb() {
  hypr-launch-webapp "$1"
}

#######################################
# Displays a menu for Linux-related cheatsheets and tools.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowLinuxMenu() {
  local options="  Bash (Devhints)\n  Linux CLI (PhoenixNAP)\n  sed (QuickRef)\n  awk (QuickRef)\n  curl (Ritchie Spears)\n  find command (Devhints)\n  tmux (Devhints)\n  systemd (Clemson University)\n  Vim (QuickRef)\n  Emacs (QuickRef)\n󰆍  GTFOBins\n󰢹  LOLBAS\n󰌆  PEASS / Privilege Escalation (GitHub)\n󱂅  SecLists (GitHub)\n  Back"
  local choice
  choice=$(Menu "  Linux" "${options}")

  case "${choice}" in
    *"Bash"*) OpenWeb "https://devhints.io/bash" ;;
    *"Linux CLI"*) OpenWeb "https://phoenixnap.com/kb/linux-commands-cheat-sheet" ;;
    *"sed"*) OpenWeb "https://quickref.me/sed" ;;
    *"awk"*) OpenWeb "https://quickref.me/awk" ;;
    *"curl"*) OpenWeb "https://www.ritchiespears.com/wiki/curl" ;;
    *"find"*) OpenWeb "https://devhints.io/find" ;;
    *"tmux"*) OpenWeb "https://devhints.io/tmux" ;;
    *"systemd"*) OpenWeb "https://people.computing.clemson.edu/~jmarty/courses/commonCourseContent/common/cheatSheets/systemd-cheat-sheet.pdf" ;;
    *"Vim"*) OpenWeb "https://quickref.me/vim" ;;
    *"Emacs"*) OpenWeb "https://quickref.me/emacs" ;;
    *"GTFOBins"*) OpenWeb "https://gtfobins.github.io/" ;;
    *"LOLBAS"*) OpenWeb "https://lolbas-project.github.io/" ;;
    *"PEASS"*) OpenWeb "https://github.com/carlospolop/PEASS-ng" ;;
    *"SecLists"*) OpenWeb "https://github.com/danielmiessler/SecLists" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for web security resources.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowWebSecMenu() {
  local options="󰈙  OWASP Top 10\n󰈙  OWASP API Security Top 10\n󰈙  OWASP Cheat Sheet Series\n󱔗  HackTricks\n󰊂  PayloadsAllTheThings\n󰅘  PortSwigger XSS Cheat Sheet\n󰅘  PortSwigger SQLi Cheat Sheet\n󰀟  JWT.io (Debugger & Libraries)\n󰆆  Web Attack Cheat Sheet (practical)\n  Back"
  local choice
  choice=$(Menu "󰖟  Web Security" "${options}")

  case "${choice}" in
    *"Top 10"*) OpenWeb "https://owasp.org/www-project-top-ten/" ;;
    *"API Security"*) OpenWeb "https://owasp.org/API-Security/editions/2023/en/0x00-header/" ;;
    *"Cheat Sheet Series"*) OpenWeb "https://cheatsheetseries.owasp.org/" ;;
    *"HackTricks"*) OpenWeb "https://book.hacktricks.xyz/" ;;
    *"PayloadsAllTheThings"*) OpenWeb "https://swisskyrepo.github.io/PayloadsAllTheThings/" ;;
    *"PortSwigger XSS"*) OpenWeb "https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" ;;
    *"PortSwigger SQLi"*) OpenWeb "https://portswigger.net/web-security/sql-injection/cheat-sheet" ;;
    *"JWT"*) OpenWeb "https://jwt.io/" ;;
    *"Web Attack"*) OpenWeb "https://github.com/riramar/Web-Attack-Cheat-Sheet" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for Python programming language cheatsheets.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowPythonMenu() {
  local options="  Python Cheatsheet (pythoncheatsheet.org)\n  Python for Data Science (DataCamp)\n  Python Security (Bandit)\n  Back"
  local choice
  choice=$(Menu "  Python" "${options}")

  case "${choice}" in
    *"Python Cheatsheet"*) OpenWeb "https://www.pythoncheatsheet.org/" ;;
    *"Python for Data Science"*) OpenWeb "https://www.datacamp.com/cheat-sheet/python-for-data-science-cheat-sheet" ;;
    *"Python Security"*) OpenWeb "https://bandit.readthedocs.io/en/latest/" ;;
    *) ShowProgrammingMenu ;;
  esac
}

#######################################
# Displays a menu for programming language cheatsheets.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowProgrammingMenu() {
  local options="  Python\n  Rust (cheats.rs)\n  Go (Devhints)\n  JavaScript (Devhints)\n  SQL Cheatsheet (SQLTutorial)\n  Bash (Devhints)\n󰡨  Docker (Devhints)\n󰡨  Docker Compose (Devhints)\n  GTK4 Reference (official)\n  Back"
  local choice
  choice=$(Menu "  Programming" "${options}")

  case "${choice}" in
    *"Python"*) ShowPythonMenu ;;
    *"Rust"*) OpenWeb "https://cheats.rs/" ;;
    *"Go"*) OpenWeb "https://devhints.io/go" ;;
    *"JavaScript"*) OpenWeb "https://devhints.io/javascript" ;;
    *"SQL"*) OpenWeb "https://www.sqltutorial.org/sql-cheat-sheet/" ;;
    *"Bash"*) OpenWeb "https://devhints.io/bash" ;;
    *"Docker (Devhints)"*) OpenWeb "https://devhints.io/docker" ;;
    *"Docker Compose"*) OpenWeb "https://devhints.io/docker-compose" ;;
    *"GTK4"*) OpenWeb "https://docs.gtk.org/gtk4/" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for hacking and penetration testing resources.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowHackingMenu() {
  local options="  Exploit-DB (search)\n  Reverse Shells (revshells.com)\n  Pentest Monkey (reverse shells)\n󱍴  Metasploit Docs\n󱗺  InternalAllTheThings\n  WinPEAS / Windows Priv Esc (GitHub)\n󰢡  CyberChef (The Cyber Swiss Army Knife)\n󰢡  CrackStation (Online Hash Cracker)\n󰊂  PayloadsAllTheThings\n󰈙  OWASP Injection Cheatsheet\n  Back"
  local choice
  choice=$(Menu "󰲯  Hacking" "${options}")

  case "${choice}" in
    *"Exploit-DB"*) OpenWeb "https://www.exploit-db.com/" ;;
    *"Reverse Shells"*) OpenWeb "https://revshells.com/" ;;
    *"Pentest Monkey"*) OpenWeb "https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" ;;
    *"Metasploit"*) OpenWeb "https://docs.rapid7.com/metasploit/" ;;
    *"InternalAllTheThings"*) OpenWeb "https://swisskyrepo.github.io/InternalAllTheThings/" ;;
    *"WinPEAS"*) OpenWeb "https://github.com/carlospolop/PEASS-ng" ;;
    *"CyberChef"*) OpenWeb "https://gchq.github.io/CyberChef/" ;;
    *"CrackStation"*) OpenWeb "https://crackstation.net/" ;;
    *"PayloadsAllTheThings"*) OpenWeb "https://swisskyrepo.github.io/PayloadsAllTheThings/" ;;
    *"OWASP Injection"*) OpenWeb "https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for common command-line tools.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowToolsMenu() {
  local options="󰛮  Nmap (HighOn.Coffee)\n  SQLMap (HighOn.Coffee)\n󱐋  Nikto (HighOn.Coffee)\n󰒒  ffuf (GitHub)\n󰘦  Burp Suite Docs\n󰍽  Wireshark User Guide\n󰢟  John the Ripper (wiki)\n󰢟  Hashcat (wiki)\n  Back"
  local choice
  choice=$(Menu "  Tools" "${options}")

  case "${choice}" in
    *"Nmap"*) OpenWeb "https://highon.coffee/blog/nmap-cheat-sheet/" ;;
    *"SQLMap"*) OpenWeb "https://highon.coffee/blog/sqlmap-cheat-sheet/" ;;
    *"Nikto"*) OpenWeb "https://highon.coffee/blog/nikto-cheat-sheet/" ;;
    *"ffuf"*) OpenWeb "https://github.com/ffuf/ffuf" ;;
    *"Burp"*) OpenWeb "https://portswigger.net/burp/documentation" ;;
    *"Wireshark"*) OpenWeb "https://www.wireshark.org/docs/wsug_html_chunked/" ;;
    *"John"*) OpenWeb "https://www.openwall.com/john/doc/" ;;
    *"Hashcat"*) OpenWeb "https://hashcat.net/wiki/" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for cloud technology documentation.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowCloudMenu() {
  local options="  AWS CLI (Devhints)\n  AWS Whitepapers & Architecture\n Azure CLI Docs\n  GCP gcloud Docs\n󱄚  OpenShift Docs\n󰰞  Terraform (Devhints)\n  Back"
  local choice
  choice=$(Menu "  Cloud" "${options}")

  case "${choice}" in
    *"AWS CLI"*) OpenWeb "https://devhints.io/aws-cli" ;;
    *"AWS Whitepapers"*) OpenWeb "https://aws.amazon.com/whitepapers/" ;;
    *"Azure"*) OpenWeb "https://learn.microsoft.com/en-us/cli/azure/reference-index" ;;
    *"GCP"*) OpenWeb "https://cloud.google.com/sdk/gcloud/reference" ;;
    *"OpenShift"*) OpenWeb "https://docs.openshift.com/container-platform/latest/" ;;
    *"Terraform"*) OpenWeb "https://devhints.io/terraform" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for Kubernetes documentation.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowK8sMenu() {
  local options="󰠱  Kubernetes Official Docs\n󰠱  Kubernetes Cheatsheet (kubectl)\n󰠱  Helm Docs\n󰠱  Kubernetes Security (CIS / k8s docs)\n  Back"
  local choice
  choice=$(Menu "󰷤  Kubernetes" "${options}")

  case "${choice}" in
    *"Official"*) OpenWeb "https://kubernetes.io/docs/" ;;
    *"Cheatsheet"*) OpenWeb "https://kubernetes.io/docs/reference/kubectl/cheatsheet/" ;;
    *"Helm"*) OpenWeb "https://helm.sh/docs/" ;;
    *"Security"*) OpenWeb "https://kubernetes.io/docs/concepts/security/" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for security documentation and frameworks.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowSecurityDocsMenu() {
  local options="󱘖  MITRE ATT&CK\n󰓾  CIS Benchmarks\n󰙵  NIST Cybersecurity Framework\n󰢻  SANS Resources (Posters, Cheatsheets)\n󰈙  OWASP Cheat Sheet Series\n󰈙  OWASP CSRF Prevention\n  Back"
  local choice
  choice=$(Menu "  Security Docs" "${options}")

  case "${choice}" in
    *"MITRE"*) OpenWeb "https://attack.mitre.org/" ;;
    *"CIS"*) OpenWeb "https://www.cisecurity.org/benchmarks/" ;;
    *"NIST"*) OpenWeb "https://www.nist.gov/cyberframework" ;;
    *"SANS"*) OpenWeb "https://www.sans.org/posters/" ;;
    *"OWASP"*) OpenWeb "https://cheatsheetseries.owasp.org/" ;;
    *"OWASP CSRF"*) OpenWeb "https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays a menu for networking-related cheatsheets.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowNetworkingMenu() {
  local options="󰀂  OSI & TCP/IP Model (Cloudflare)\n󰒄  tcpdump Cheatsheet (Comparitech)\n󰒄  netcat Cheatsheet (SANS)\n󰍽  Wireshark Display Filters (Official)\n󰛮  Nmap Cheatsheet (HighOn.Coffee)\n󰈙  OWASP TLS Cheatsheet\n  Back"
  local choice
  choice=$(Menu "󰀂  Networking" "${options}")

  case "${choice}" in
    *"OSI"*) OpenWeb "https://www.cloudflare.com/learning/ddos/glossary/open-systems-interconnection-model-osi/" ;;
    *"tcpdump"*) OpenWeb "https://www.comparitech.com/net-admin/tcpdump-cheat-sheet/" ;;
    *"netcat"*) OpenWeb "https://www.sans.org/tools/netcat/" ;;
    *"Wireshark"*) OpenWeb "https://www.wireshark.org/docs/dfref/" ;;
    *"Nmap"*) OpenWeb "https://highon.coffee/blog/nmap-cheat-sheet/" ;;
    *"OWASP TLS"*) OpenWeb "https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Security_Cheat_Sheet.html" ;;
    *) ShowMainMenu ;;
  esac
}

#######################################
# Displays the main cheatsheet menu.
# Globals:
#   None
# Arguments:
#   None
# Outputs:
#   None
#######################################
ShowMainMenu() {
  local options="󰣇  Linux\n󰖟  Web Security\n  Programming\n󰲯  Hacking\n  Tools\n󰀂  Networking\n  Cloud\n󰷤  Kubernetes\n  Security Docs\n󰅖  Exit"
  local choice
  choice=$(Menu "󱔆  Cheatsheets" "${options}")

  case "${choice}" in
    *"Linux"*) ShowLinuxMenu ;;
    *"Web"*) ShowWebSecMenu ;;
    *"Programming"*) ShowProgrammingMenu ;;
    *"Hacking"*) ShowHackingMenu ;;
    *"Tools"*) ShowToolsMenu ;;
    *"Networking"*) ShowNetworkingMenu ;;
    *"Cloud"*) ShowCloudMenu ;;
    *"Kubernetes"*) ShowK8sMenu ;;
    *"Security"*) ShowSecurityDocsMenu ;;
    *"Exit"*) exit 0 ;;
  esac
}

#######################################
# Main function to run the script.
# Globals:
#   None
# Arguments:
#   $@ - The script arguments, used for deep linking to a specific menu.
# Outputs:
#   None
#######################################
main() {
  export PATH="${HOME}/.local/share/hypr/bin:${PATH}"

  if [[ -n "${1:-}" ]]; then
    local menu_target="${1,,}"
    case "${menu_target}" in
      "linux") ShowLinuxMenu ;;
      "web") ShowWebSecMenu ;;
      "prog") ShowProgrammingMenu ;;
      "hack") ShowHackingMenu ;;
      "tools") ShowToolsMenu ;;
      "net" | "network") ShowNetworkingMenu ;;
      "cloud") ShowCloudMenu ;;
      "k8s") ShowK8sMenu ;;
      "security") ShowSecurityDocsMenu ;;
      *) ShowMainMenu ;;
    esac
  else
    ShowMainMenu
  fi
}

main "$@"
