#!/bin/bash
#
# Manages simple state flags by creating or deleting files in a dedicated
# state directory. This is a lightweight way for scripts to track state.

set -euo pipefail

readonly STATE_DIR="${HOME}/.local/state/hypr"

#######################################
# Main function to set or clear a state flag.
# Globals:
#   STATE_DIR
# Arguments:
#   $1 - The command (set|clear).
#   $2 - The name or pattern of the state flag.
# Outputs:
#   Exits with an error if arguments are missing or the command is invalid.
#######################################
main() {
  mkdir -p "${STATE_DIR}"

  local command="${1:-}"
  local state_name="${2:-}"

  if [[ -z "${command}" ]]; then
    echo "Usage: $(basename "$0") <set|clear> <state-name-or-pattern>" >&2
    exit 1
  fi

  if [[ -z "${state_name}" ]]; then
    echo "Usage: $(basename "$0") ${command} <state-name>" >&2
    exit 1
  fi

  case "${command}" in
  set)
    touch "${STATE_DIR}/${state_name}"
    ;;
  clear)
    find "${STATE_DIR}" -maxdepth 1 -type f -name "${state_name}" -delete
    ;;
  *)
    echo "Error: Invalid command '${command}'. Use 'set' or 'clear'." >&2
    exit 1
    ;;
  esac
}

main "$@"
